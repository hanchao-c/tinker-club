(function($){$.fn.extend({"buildImageUploader":function(option){option=$.extend({"method":"POST","maxFiles":10,"maxFilesize":2,"acceptedFiles":"image/*"},option);Dropzone.autoDiscover=false;var $this=$(this);return $this.dropzone({"url":option.url?option.url:"../images","method":option.method,"maxFiles":option.maxFiles,"maxFilesize":option.maxFilesize,"acceptedFiles":option.acceptedFiles,"addRemoveLinks":true,"clickable":true,"autoProcessQueue":true,"dictDefaultMessage":option.dictDefaultMessage?option.dictDefaultMessage:"拖拽或者点击","dictFallbackMessage":"当前浏览器不支持拖拽文件到控件","dictInvalidFileType":"只支持 "+option.acceptedFiles+" 文件类型","dictFileTooBig":"文件大小不能超过"+option.maxFilesize+"MB","dictResponseError":"上传到服务器失败","dictMaxFilesExceeded":"最多可以上传"+option.maxFiles+"个文件","dictCancelUpload":"取消上传","dictRemoveFile":"删除","dictCancelUploadConfirmation":"确定","imgWidth":option.imgWidth?option.imgWidth:null,"imgHeight":option.imgHeight?option.imgHeight:null,"thumbnailWidth":option.thumbnailWidth?option.thumbnailWidth:null,"thumbnailHeight":option.thumbnailHeight?option.thumbnailHeight:null,"moveable":option.moveable,"init":function(){var _this=this;_this.on("removedfile",function(file){processDropzoneFile($this,_this)}).on("success",function(file,data,e){file.resourceId=data.resourceId;processDropzoneFile($this,_this)});$this.data("dropzoneinstance",_this)}})},"imageValues":function(){var $this=$(this);if(arguments.length>0){var source=arguments[0];if(source){var $this=$(this);var array=(source.constructor==String)?source.split(","):source;var dropzoneInstance=$this.data("dropzoneinstance");for(var i=0;i<array.length;i++){setView(dropzoneInstance,array[i],$this)}}}else{var dropzoneInstance=$this.data("dropzoneinstance");processDropzoneFile($this,dropzoneInstance);return $this.data("views")}function setView(myDropzone,resourceId,el){var mockFile={"resourceId":resourceId,"status":"success","accepted":true,"dataURL":resourceId};myDropzone.emit("addedfile",mockFile);myDropzone.createThumbnailFromUrl(mockFile,myDropzone.options.thumbnailWidth,myDropzone.options.thumbnailHeight,myDropzone.options.thumbnailMethod,true,function(thumbnail){myDropzone.emit("thumbnail",mockFile,thumbnail)},"anonymous");myDropzone.emit("complete",mockFile);myDropzone.files.push(mockFile);$(mockFile.previewElement).find(".dz-size,.dz-filename").hide();processDropzoneFile(el,myDropzone)}},"clearImages":function(){var $this=$(this);var dropzoneInstance=$this.data("dropzoneinstance");dropzoneInstance.removeAllFiles()},"getSuccessFiles":function(){var $this=$(this);var dropzoneInstance=$this.data("dropzoneinstance");return dropzoneInstance.getFilesWithStatus(Dropzone.SUCCESS)},"getErrorFiles":function(){var $this=$(this);var dropzoneInstance=$this.data("dropzoneinstance");return dropzoneInstance.getFilesWithStatus(Dropzone.ERROR)},"isUploading":function(){var $this=$(this);var dropzoneInstance=$this.data("dropzoneinstance");var uploadingFiles=dropzoneInstance.getActiveFiles();return uploadingFiles.length>0}})})(jQuery);function processDropzoneFile(el,_this){var fileArray=_this.getFilesWithStatus(Dropzone.SUCCESS);var fileResourceIds=$.map(fileArray,function(file,index){return file.resourceId}).filter(function(resourceId){return undefined!=resourceId&&resourceId&&resourceId.length>0}).join();el.data("views",fileResourceIds)};